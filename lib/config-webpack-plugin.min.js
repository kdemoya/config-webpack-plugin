"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _toConsumableArray(e){if(Array.isArray(e)){for(var r=0,t=Array(e.length);r<e.length;r++)t[r]=e[r];return t}return Array.from(e)}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}(),_path=require("path"),_path2=_interopRequireDefault(_path),ConfigPlugin=function(){function e(r){if(_classCallCheck(this,e),"string"==typeof r&&(r=[r]),!Array.isArray(r))throw new Error("The configuration file should be a string or an array.");var t=process.cwd();this.files=r.map(function(e){return{request:e,path:_path2.default.join(t,e)}})}return _createClass(e,[{key:"apply",value:function(e){var r=this,t=this.load(this.files),n=this.merge(t.map(function(e){return e.source})),a=this.files[0];e.plugin("normal-module-factory",function(e){e.plugin("after-resolve",function(e,t){var o=e.resource;return o===a.path&&r.intercept(e,n),t(null,e)})})}},{key:"load",value:function(e){var r=_path2.default.relative(__dirname,process.cwd());return e.map(function(e){try{var t=_path2.default.join(r,e.request);return e.source=require(t),e}catch(e){throw new Error("Cannot load: "+_path2.default+". "+e.message)}})}},{key:"merge",value:function(e){var r=Object.assign.apply(Object,[{}].concat(_toConsumableArray(e)));return Object.keys(process.env).forEach(function(e){r.hasOwnProperty(e)&&(r[e]=process.env[e])}),r}},{key:"intercept",value:function(e,r){var t=_path2.default.join(__dirname,"config-loader.js"),n=JSON.stringify(r);e.loaders=[t+"?"+n]}}]),e}();module.exports=ConfigPlugin;